Preparing the data file
=======================

The data file is named after the Moodle major version number (for example: 310)
and contains all files present in previous Moodle versions that a direct
upgrade to that version is possible from (for example: for Moodle 3.10, it's
Moodle 3.5 or later as listed under
https://docs.moodle.org/dev/Moodle_3.10_release_notes#Server_requirements).

This process is a bit cumbersome but it needs doing once per Moodle version to
be checked.

To prepare this file you'll need to have Git on Linux.

Steps:

  git clone git://git.moodle.org/moodle.git
  cd moodle
  git checkout MOODLE_310_STABLE
  find . | sort > /tmp/find-310
  git checkout MOODLE_39_STABLE
  find . | sort > /tmp/find-39
  git checkout MOODLE_38_STABLE
  find . | sort > /tmp/find-38
  git checkout MOODLE_37_STABLE
  find . | sort > /tmp/find-37
  git checkout MOODLE_36_STABLE
  find . | sort > /tmp/find-36
  git checkout MOODLE_35_STABLE
  find . | sort > /tmp/find-35
  diff --changed-group-format='%<' --unchanged-group-format='' /tmp/find-39 \
    /tmp/find-310 > /tmp/diff-39
  diff --changed-group-format='%<' --unchanged-group-format='' /tmp/find-38 \
    /tmp/find-310 > /tmp/diff-38
  diff --changed-group-format='%<' --unchanged-group-format='' /tmp/find-37 \
    /tmp/find-310 > /tmp/diff-37
  diff --changed-group-format='%<' --unchanged-group-format='' /tmp/find-36 \
    /tmp/find-310 > /tmp/diff-36
  diff --changed-group-format='%<' --unchanged-group-format='' /tmp/find-35 \
    /tmp/find-310 > /tmp/diff-35
  comm -3 /tmp/find-310 /tmp/diff-35 > /tmp/310
  comm -3 /tmp/310 /tmp/diff-36 > /tmp/310
  comm -3 /tmp/310 /tmp/diff-37 > /tmp/310
  comm -3 /tmp/310 /tmp/diff-38 > /tmp/310
  comm -3 /tmp/310 /tmp/diff-39 > /tmp/310

Tidy /tmp/310 in Vim:
:%s/\.\///
:g/\.git/d

Manually remove the files from that version in
lib/upgradelib.php:upgrade_stale_php_files_present() removed in that version.

The resulting /tmp/310 file is the list of files that was in all upgradable
previous versions but not in the new version *except* for the handful of files
Moodle checks.
